<!DOCTYPE html>
<html>
<head>
    <title>Draw and Transform</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>Draw an Image</h1>

<canvas id="canvas" width="400" height="400" style="border: 1px solid;"></canvas>

<button id="submit">Transform Image</button>

<img id="result-image" src="" alt="Transformed Image" style="display:none;">

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let drawing = false;

canvas.addEventListener('mousedown', () => { drawing = true; });
canvas.addEventListener('mouseup', () => { drawing = false; ctx.beginPath(); });

canvas.addEventListener('mousemove', draw);

function draw(event) {
    if (!drawing) return;

    ctx.lineWidth = 5;
    ctx.lineCap = 'round';
    ctx.strokeStyle = 'black';

    ctx.lineTo(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(event.clientX - canvas.offsetLeft, event.clientY - canvas.offsetTop);
}

$('#submit').click(function() {
    const dataURL = canvas.toDataURL();
    
    $.ajax({
        type: 'POST',
        url: '/transform',
        data: {
            imageBase64: dataURL
        },
        success: function(resultImage) {
            let blob = new Blob([resultImage], { type: "image/png" });
            let url = window.URL.createObjectURL(blob);
            $("#result-image").attr("src", url).show();
        }
    });
});
</script>

</body>
</html>
